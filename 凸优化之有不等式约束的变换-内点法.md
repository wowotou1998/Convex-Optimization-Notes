## 含不等式约束的优化问题的求解方法-内点法
**为什么凸优化只讨论含等式约束和不等式约束的优化问题, 因为不等式约束经过障碍法的处理都可以放到目标函数中去, 得到只留下等式约束的优化问题, 因此我们只需要关心含等式约束的优化问题.**
>We can view interior-point methods as another level in the hierarchy of convex optimization algorithms. Linear equality constrained quadratic problems are the simplest. For these problems the KKT conditions are a set of linear equations, which can be solved analytically. Newton’s method is the next level in the hierarchy. We can think of Newton’s method as a technique for solving a linear equality constrained optimization problem, with twice differentiable objective, by reducing it to a sequence of linear equality constrained quadratic problems. Interior-point methods form the next level in the hierarchy: They solve an optimization problem with linear equality and inequality constraints by reducing it to a sequence of linear equality constrained problems.
我们可以把内点法看作凸优化算法的另一个层次。
带线性等式约束的二次型问题是最简单的。对于这些问题，KKT条件是一组可以解析求解的线性方程组 (直接求解这个方程就可以得到整个问题的最优解)。
牛顿法是层次结构中的下一层。我们可以把牛顿法看作是一种求解具有二次可微目标的线性等式约束优化问题的技术，通过将其化为一系列线性等式约束的二次问题 (迭代求解,将问题归纳到带线性等式的二次型问题).
内点法是层次结构中的下一层:它们通过将具有线性等式和不等式约束的优化问题简化为一系列线性等式约束问题来解决该问题 (将问题缩放到牛顿法可以处理的范围)。 

 ```mermaid
    graph BT
    A[带等式约束的二次型优化]
    B["带等式约束的优化问题(目标函数二次可微)"]
    C["带不等式和等式约束的优化问题(目标函数二次可微)"]
    S1(求解KKT系统,即求解线性方程)
    S2(二阶近似目标函数,然后求解线性KKT系统)
    S3(障碍法将不等式约束放入目标函数,二阶近似目标函数,然后求解线性KKT系统)
    B-->|转化|A
    C-->|转化|B
    S1-.->|求解|A
    S2-.->|求解|B
    S3-.->|求解|C
 ```
---
### 优化过程
### 对数障碍 $\text{log barrier}$
首先, 介绍一下 $\text{log barrier}$ 方法:
$$
\begin{array}{lll}
\min & f_{0}(x) &\\
\text{s.t.} & f_{i}(x) \leq 0 &  i=1 \cdots m \\
            & Ax = b    &   \\
\Leftrightarrow & & \\
\min &  f_{0}(x)+\sum_{i=1}^{m}-(1 / t) \log \left(-f_{i}(x)\right)
\\
\text{s.t.} &  A x=b
\end{array}
$$

这是一个惩罚的思想. 具体来说就是 $f_{i}(x) \rightarrow 0$ 时, $p^{*} \rightarrow+\infty$, 会让目标函数根本无法得到最优解, 就好像有一个“棚栏”一样, 阻止 $f_{i}(x)$ 趋近于 0, 让它只能小于0. 基于 $\text{log barrier}$ 方法, **我们之后所有的约束都只讨论等式约束, 不等式约束用 $\text{log barrier}$ 去掉.  即所有的凸问题都形如:**
$$
\begin{array}{lll}
\min &  f_{0}(x) & \\
\text {s.t. } & Ax=b & 
\end{array}
$$

由于 $-(1 / t) \log (-u)$ 是 $u$ 的单增凸函数, 上式中的目标函数是可微凸函数. 假定恰当的闭性条件成立，则可用 Newton 方法求解该问题. 
我们将函数
$$
\phi(x)=-\sum_{i=1}^{m} \log \left(-f_{i}(x)\right)
$$
$\operatorname{dom} \phi=\left\{x \in \mathbf{R}^{n} \mid f_{i}(x)<0, i=1, \cdots, m\right\}$ 称为原问题的对数障碍函数或对数障碍. 其定义域是满足原问题的严格不等式约束的点集. 不管正参数 $t$ 取什么值， 对于任意 $i$, 当 $f_{i}(x) \rightarrow 0$ 时，对数障碍函数将趋于无穷大. 并且, 我们可以知道当 $t$ 越来越大时, $\sum_{i=1}^{m}-(1 / t) \log \left(-f_{i}(x)\right)$ 会非常近似于指示函数($\text{indicator function}$), 即当 $f_{i}(x)<0$ 时, $\sum_{i=1}^{m}-(1 / t) \log \left(-f_{i}(x)\right) = 0$, 当 $f_{i}(x) = 0$ 时,$\sum_{i=1}^{m}-(1 / t) \log \left(-f_{i}(x)\right) = +\infty$


### 有等式约束的优化问题定义

$$
\begin{array}{ll}
\min  &f(x) \\
\text{s.t.} &A x = b
\end{array} \tag{eq0}
$$

计算它的 $\text{KKT}$ 条件:
$$
x^{*} 是最优解, v^{*} 是拉格朗日乘子 \\
\left\{
\begin{array}{l}
A x^{*}=b \quad \text{primal feasibility}
\\
\nabla f\left(x^{*}\right)+A^{T} v^{*}=0  \quad \text{stationarity}
\end{array}
\right.
$$

解约束优化问题就不得不用到 $\text{KKT}$ 条件了，解 $\text{KKT}$ 条件(如果可解的话), 那么相当于一次性 把原问题和对偶问题的最优解都解出来了. 目前有一个从 $\text{KKT}$ 条件出发得出的算法, 就叫做拉格朗日乘子法]

### 当目标函数 $f(x)$ 是二次函数时, $\text{KKT}$ 条件是线性方程组

当目标函数 $f(x)$ 是二次函数时,  $\text{KKT}$ 条件是线性方程组.例如
$$
\begin{array}{ll}
\text{min}  &\frac{1}{2} x^{T} P x+q^{T} x+r \\
\text{s.t.} &A x = b
\end{array}
$$

其中 $P \in S_{+}^{n}, A$ 一般是不可逆的(这样 $x$ 才会是有一个解集的), 否则可逆矩阵的方程组 有唯一解就谈不上要优化了. 
计算这个问题的 $\text{KKT}$ 条件为:
$$\left\{\begin{array}{ll}A x^{*} =b \\ P x^{*} +q+A^{T} v^{*}=0\end{array}\right.
\Leftrightarrow
\left[\begin{array}{cc}P & A^{T} \\ A & 0\end{array}\right] \cdot\left[\begin{array}{l}x^{*} \\ v^{*}\end{array}\right]=\left[\begin{array}{c}-q \\ b\end{array}\right]$$
我们会发现，这时候 $\text{KKT}$ 条件也是一个线性的方程组, 主要原因就是 $\nabla f\left(x^{*}\right)$ 是线性的, 这 个时候就可以用Gauss-Seidel等解线性方程组的方法求解最优值了. 这样的情况不需要什么下降算法, 本质就是求解线性方程组. 当然, 你也可以转化为求无约束优化的对偶问题. 

### 当目标函数 $f(x)$ 是高次函数时, $\text{KKT}$ 条件不是线性的方程组

